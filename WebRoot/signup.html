<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>智惠加油注册页</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
<style type="text/css">
html {
height: 100%;

}
body {
margin: 0;
padding: 0;
height: 100%;
}
div{ margin:0 auto; padding:0;}
input{ margin:0; padding:0;border:none; color:#999999; font-size:16px;}
.main{ width:100%; height:450px; min-height:450ox; margin:0 auto; background:#EEEEEE; font-size:16px;}
.nav{ background:#ffffff;height:30px;padding:5px;}
.conten{ margin:30px 2px;}
.t{ background:#ffffff;margin:2px 5px;height:35px;line-height:35px; color:#777777; text-align:left; padding-left:10px;}
.text{width:160px; height:21px; background:#FFFFFF;}
.text1{width:130px; height:21px; background:#FFFFFF;}
.textji{height:35px;font-size:12px; color:#FFFFFF; background-image:url(btn_green.png); margin:30px 15px;}
.button{width:40px; font-size:13px; height:24px; background-image:url(btn_green.png); color:#FFFFFF;}
.btnsubit{width:100%; font-size:16px; height:35px; background-image:url(btn_green.png); color:#FFFFFF;}
.foot{font-size:9px; color:#666666; text-align:left; padding-left:20px;}
a:link{ color:#658BA3;}
</style>
<link rel="stylesheet" type="text/css" href="css/component.css" />
<script src="js/modernizr.custom.js"></script>
</head>

<body>


<div style=" text-align:center;" >
<form name="login" id="form1" method="post" action="">
  <div class="main">
    <div class="nav">注册</div>
    <div class="conten">
      <div  class="t">手机号 &nbsp;<input type="text" id="phone" name="phone" class="text" maxlength="11" value="请输入手机号"onfocus="if (value =='请输入手机号'){value 
=''}"onblur="if (value 
==''){value='请输入手机号'}" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')"/></div>  
      <div  class="t">验证码 &nbsp;<input type="text" id="code" name="checkno" class="text1" maxlength="6" value="请输短信验证码"onfocus="if (value =='请输短信验证码'){value 
=''}"onblur="if (value 
==''){value='请输短信验证码'}"/><input id="btn" type="button" style="width:80px; margin-left:10px" value="获取验证码"  class="button"/></div>
      </div>
  <div class="conten">
      <div  class="t">密码 &nbsp;<input type="text" id="password" name="pwd" class="text" maxlength="16" value="6~16位数字或者字母"onfocus="if (value =='6~16位数字或者字母'){value 
='';type='password' }"onblur="if (value 
==''){value='6~16位数字或者字母';type='text'}"/></div>  
      <div  class="t">确认密码 &nbsp;<input type="text" id="re_password" name="checkpwd" class="text"  maxlength="16" value="6~16位数字或者字母"onfocus="if (value =='6~16位数字或者字母'){value 
='';type='password' }"onblur="if (value 
==''){value='6~16位数字或者字母';type='text'}"/></div>
      <div class="textji">
      <section><button class="progress-button" onclick="signup()" data-style="fill" data-horizontal style="width:100%">提交</button>
      </section></div>
    <div class="foot">点击提交,表示您同意<a href="http://www.wonpon.com/pages-3/blank/yszc/" style="text-decoration:none">《智惠加油注册协议》</a></div>
  </div>
  </form>
</div>
<script type="text/javascript" src="common/easyui/jquery.min.js"></script>
<script type="text/javascript" src="/common/js/md5.min.0.9.5.js"></script>
 <script type="text/javascript">
 var search = window.location.search;
	var recommendId = search.split('=')[1];
	function signup(){
		
		var password = $('#password').val();
		var repassword = $('#re_password').val();
		if(password=='6~16位数字或者字母'||repassword=='6~16位数字或者字母'){
			alert('请输入密码');
			return;
		}
		if(password!=repassword){
			alert('两次密码不一致');
			return;
		}
		var phone = $('#phone').val();
		if(phone=="请输入手机号"){
			alert('请输入手机号码');
			return;
		}
		var code = $('#code').val();
		if(code=="请输短信验证码"){
			alert('请输入验证码');
			return;
		}
		var pwd = $('#password').val();
		pwd = hex_md5(pwd).toUpperCase();
		$.ajax({
			url:'/api/signUp.do?userName='+phone+"&password="+pwd+"&code="+code+"&recommendId="+recommendId,
			success : function(data){
				console.log(data);
				data = JSON.parse(data);
				window.location.href='welcome.html';
    			if(data.code=='0000'){
    				window.location.href='welcome.html';
    			}else{
    				alert(data.msg);
    				return;
    			}
			}
		})
	}
 
 
 
var wait=60;
document.getElementById("btn").disabled = false;   
function time(o) {
		if(wait==60){
			var phone = $('#phone').val();
        	if(phone==""||phone=='请输入手机号'){
        		alert('请输入手机号码');
        		return;
        	}
        	$.ajax({
        		url:'/api/sendMessage.do?type=3032&phone='+phone,
        		success : function(data){
        			data = JSON.parse(data);
        			if(data.code=='0000'){
        				alert('短信已发出，请注意查收');
        			}else{
        				alert(data.msg);
        			}
        		}
        	});
		}
	
        if (wait == 0) {
            o.removeAttribute("disabled");           
            o.value="获取验证码";
            wait = 60;
        } else {
            o.setAttribute("disabled", true);
            o.value="重新发送(" + wait + ")";
            wait--;
            setTimeout(function() {
                time(o)
            },
            1000)
        }
    }
document.getElementById("btn").onclick=function(){time(this);}
</script> 

<script src="js/classie.js"></script>
<script src="js/progressbutton.js"></script>
<script>
[].slice.call( document.querySelectorAll( 'button.progress-button' ) ).forEach( function( bttn ) {
        new ProgressButton( bttn, {
        callback : function( instance ) {
            var progress = 0,
            interval = setInterval( function() {
            progress = Math.min( progress + Math.random() * 0.1, 1 );
            instance._setProgress( progress );

            if( progress === 1 ) {
                instance._stop(1);
                clearInterval( interval );
            }
            }, 200 );
        }
        } );
});
</script>
</body>
</html>
