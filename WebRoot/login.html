<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>系统管理 - 用户登录</title>
	
	<link rel="stylesheet" type="text/css" href="common/bootstrap/css/bootstrap.css" />
	<link rel="stylesheet" type="text/css" href="common/bootstrap/css/bootstrap-ie6.min.css" />
	<link rel="stylesheet" type="text/css" href="common/easyui/themes/bootstrap/easyui.css" />
	<link rel="stylesheet" type="text/css" href="common/easyui/themes/icon.css" />
	<link rel="stylesheet" type="text/css" href="common/easyui/themes/color.css" />
	<link rel="stylesheet" type="text/css" href="common/bootstrap/css/ie.css" />
	<script type="text/javascript" src="common/easyui/jquery.min.js"></script>
	<script type="text/javascript" src="common/easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="common/bootstrap/js/bootstrap.min.js"></script>
	
	<script type="text/javascript">
		var ie = null;
		var ua = navigator.userAgent.toLowerCase();
		if (window.ActiveXObject) {
			ie = ua.match(/msie ([\d.]+)/)[1];
		}
	
		if(ie == "6.0") {
			alert("您使用的浏览器版本过低，推荐使用更高的版本");
			document.write('<link rel="stylesheet" type="text/css" href="common/bootstrap/css/bootstrap-ie6.min.css" />');
		}
		
		//如果是Firefox 
		if (document.addEventListener) {
	       	document.addEventListener("keypress", doHandler, true);
	   	}
	   	else {
	       	document.attachEvent("onkeypress", doHandler); 
	   	}    
	   	
	   	function doHandler(evt) {
	       	if (evt.keyCode == 13) {
	           	login();
	       	}
	   	}
	   	
		
		function login() {
			var account = $('#account').val();
			var password = $('#password').val();
			var authCode = $('#authCode').val();
			
			if(account == "") {
				alert("帐号不能为空");
				return false;
			}
			
			if(password == "") {
				alert("密码不能为空");
				return false;
			}
			
			if(authCode == "") {
				alert("验证码不能为空");
				return false;
			}
			
			$.ajax({
				type: 'post',
				url: 'sys/login.do',
				data: {account: account, password: password, authCode: authCode},
				success: function(data) {
					eval('data=' + data + ';');
					if(data.success) {
						//登陆成功后先清除原来的cookie
// 						clearCookie();
						window.location.href = "index.html";
					}
					else {
						$("#authCodeImage").click();
						$('#authCode').val("");
						alert(data.message || "登录失败");
					}
				},
				error: function() {
					$.messager.alert('错误提示', '服务器异常！', 'error');
				}
			});
			
		}
		function changeVerifyCode(){
			$("#valid_code").attr("src","valid_code?r="+getRandom(9999999999));
		}
		function getRandom(n){return Math.floor(Math.random()*n+1);}
		$(function(){
			changeVerifyCode()
		})
	</script>
</head>
<body style="background-image: url(common/images/bg2.png)">
	<div id="event-window" class="modal" style="width: 360px;margin-left: -180px; top: 200px">
		<div class="modal-header">
    		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    		<h3>用户登录</h3>
  		</div>
  		<div class="modal-body">
    		<table width="100%" cellspacing="5">
				<tr>
					<td width="70" style="font-size: 12px" align="right">帐号：</td>
					<td><input id="account" type="text" style="width: 200px"/></td>
				</tr>
				<tr>
					<td style="font-size: 12px" align="right">密码：</td>
					<td><input id="password" type="password" style="width: 200px"/></td>
				</tr>
				<tr>
					<td style="font-size: 12px" align="right">验证码：</td>
					<td>
						<input type="text" style="width: 100px" id="authCode"/>
						<!-- sys/createAuthcode.do" id="authCodeImage --> 
						<img src="" id="valid_code" onclick="changeVerifyCode()">
					</td>
				</tr>
			</table>
  		</div>
  		<div class="modal-footer">
	  		<button type="submit" class="btn btn-primary" onclick="login();">登录</button>
  		</div>
	</div>
</body>
</html>