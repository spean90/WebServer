<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.webserver.dao.GasOrderDao">

	<select id="getGasOrderListByParams" resultType="GasOrder">
		select oid oId,user_id userId,sub_product_id subProductId, product_id productId, order_id orderId, sum sum, create_time createTime,gas_account gasAccount,amount,order_desc orderDesc,
		pay_order_id payOrderId ,coupon_id couponId,pay_sum paySum
		from gas_order
		<where>
		<if test="gasOrder.userId != null and gasOrder.userId != ''">
			and user_id = #{gasOrder.userId}
		</if>
		<if test="gasOrder.productId != null and gasOrder.productId != ''">
			and product_id = #{gasOrder.productId}
		</if>
		<if test="gasOrder.orderId != null and gasOrder.orderId != ''">
			and order_id = #{gasOrder.orderId}
		</if>
		<if test="gasOrder.payOrderId != null and gasOrder.payOrderId != ''">
			and pay_order_id = #{gasOrder.payOrderId}
		</if>
		<if test="gasOrder.beginTime != null and gasOrder.beginTime != ''">
			and create_time >= #{gasOrder.beginTime}
		</if>
		<if test="gasOrder.endTime != null and gasOrder.endTime != ''">
			<![CDATA[
				and create_time <= #{gasOrder.endTime}
			]]>
		</if>
		</where>
		order by oid desc 
		<if test="pageBean!= null">
			limit #{pageBean.start}, #{pageBean.rows}
		</if>
	</select>
	
	<select id="countProductByParams" resultType="java.util.Map">
		select t.product_id productId,sum(amount) amount,sum(t.sum) sum, sum(t.pay_sum) paySum,a.product_name productName
		from gas_order t
		left join product a on t.product_id = a.product_id
		<where>
		<if test="gasOrder.beginTime != null and gasOrder.beginTime != ''">
			and create_time >= #{gasOrder.beginTime}
		</if>
		<if test="gasOrder.endTime != null and gasOrder.endTime != ''">
			<![CDATA[
				and create_time <= #{gasOrder.endTime}
			]]>
		</if>
		</where>
		group by productId
		<if test="pageBean!= null">
			limit #{pageBean.start}, #{pageBean.rows}
		</if>
	</select>
	
	
	<insert id="addGasOrder" parameterType="GasOrder" useGeneratedKeys="true" keyProperty="gasOrder.oId">
		insert into gas_order (user_id, product_id, order_id, sum, create_time,gas_account,amount,order_desc,pay_order_id,coupon_id,pay_sum) 
		VALUES (#{gasOrder.userId}, #{gasOrder.productId}, #{gasOrder.orderId}, #{gasOrder.sum}, #{gasOrder.createTime}, #{gasOrder.gasAccount}, #{gasOrder.amount}, #{gasOrder.orderDesc}, #{gasOrder.payOrderId}, #{gasOrder.couponId}, #{gasOrder.paySum})
	</insert>
	
	
</mapper>