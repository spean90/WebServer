<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.webserver.dao.OperLogDao">

	<select id="getOperLogListByParams" parameterType="OperLog" resultType="OperLog">
		select t.id id, t.m_id mId, t.oper_time operTime, t.oper_action operAction, t.url url, t.params params, t.status status, t.ip ip 
		,a.real_name realName,a.manager_account managerAccount
		from oper_log t
		left join manager a on a.m_id = t.m_id
		<where>
		<if test="operLog.mId != null and operLog.mId != ''">
			and t.m_id = #{operLog.mId}
		</if>
		<if test="operLog.status != null ">
			and t.status = #{operLog.status}
		</if>
		<if test="operLog.operAction != null and operLog.operAction != ''">
			and t.oper_action like concat('%',#{operLog.operAction},'%')
		</if>
		<if test="operLog.beginTime != null and operLog.beginTime != '' ">
			and t.oper_time > #{operLog.beginTime}
		</if>
		<if test="operLog.endTime != null and operLog.endTime != '' ">
			<![CDATA[
				and t.oper_time <= #{operLog.endTime}
			]]>
		</if>
		<if test="operLog.realName != null and operLog.realName != ''">
			and a.real_name like concat('%',#{operLog.realName},'%')
		</if>
		</where>
		order by oper_time desc limit #{pageBean.start}, #{pageBean.rows}
	</select>
	
	
	<insert id="addLog" parameterType="OperLog">
		insert into oper_log (m_id, oper_time,  oper_action, url, params, status, ip) 
		VALUES (#{operLog.mId}, #{operLog.operTime},  #{operLog.operAction}, #{operLog.url}, #{operLog.params}, #{operLog.status}, #{operLog.ip})
	</insert>
</mapper>